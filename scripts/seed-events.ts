import { PrismaClient } from "../lib/generated/prisma";
import { 
  EventStatus, 
  EventCategory,
  PlaceStatus,
  ParticipationStatus,
  RecurrenceFrequency,
  UserStatus 
} from "../lib/generated/prisma";

const prisma = new PrismaClient();

async function seedEvents() {
  try {
    console.log("üå± D√©but du seed des √©v√©nements...");

    // 1. Rechercher ou cr√©er un utilisateur organisateur
    let organizer = await prisma.user.findFirst({
      where: {
        email: "organizer@example.com"
      }
    });

    if (!organizer) {
      console.log("Cr√©ation de l'utilisateur organisateur...");
      organizer = await prisma.user.create({
        data: {
          name: "Alexandre Dupont",
          email: "organizer@example.com",
          emailVerified: true,
          slug: "alexandre-dupont",
          role: "user",
          status: UserStatus.ACTIVE,
          profile: {
            create: {
              firstname: "Alexandre",
              lastname: "Dupont",
              bio: "Organisateur d'√©v√©nements culturels et musicaux √† B√©darieux depuis plus de 10 ans.",
              phone: "06 12 34 56 78",
              isPublic: true,
              showEmail: true,
              showPhone: true,
              socials: {
                facebook: "https://facebook.com/alexandre.dupont.music",
                instagram: "https://instagram.com/alex_events_bedarieux"
              }
            }
          }
        }
      });
    }

    // 2. Rechercher la place "Black Bear Studio"
    let blackBearStudio = await prisma.place.findFirst({
      where: {
        name: { contains: "Black Bear", mode: "insensitive" }
      }
    });

    if (!blackBearStudio) {
      console.log("Cr√©ation de la place Black Bear Studio...");
      blackBearStudio = await prisma.place.create({
        data: {
          name: "Black Bear Studio",
          slug: "black-bear-studio",
          type: "SERVICE",
          description: "Studio d'enregistrement professionnel √©quip√© des derni√®res technologies. Nous proposons l'enregistrement, le mixage et le mastering pour tous styles musicaux.",
          summary: "Studio d'enregistrement professionnel √† B√©darieux - Enregistrement, mixage, mastering",
          status: PlaceStatus.ACTIVE,
          isVerified: true,
          isActive: true,
          isFeatured: true,
          email: "contact@blackbearstudio.fr",
          phone: "04 67 95 12 34",
          website: "https://blackbearstudio.fr",
          street: "15 Avenue de la Musique",
          streetNumber: "15",
          postalCode: "34600",
          city: "B√©darieux",
          latitude: 43.6543,
          longitude: 3.1687,
          facebook: "https://facebook.com/blackbearstudiobedarieux",
          instagram: "https://instagram.com/blackbear_studio",
          coverImage: "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800&h=600&fit=crop",
          logo: "https://images.unsplash.com/photo-1611532736797-de8db4246439?w=200&h=200&fit=crop",
          images: JSON.stringify([
            "https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?w=800&h=600&fit=crop",
            "https://images.unsplash.com/photo-1571330735066-03aaa9429d89?w=800&h=600&fit=crop",
            "https://images.unsplash.com/photo-1519508234439-4f23643125c1?w=800&h=600&fit=crop"
          ]),
          metaTitle: "Black Bear Studio - Studio d'enregistrement √† B√©darieux",
          metaDescription: "Studio d'enregistrement professionnel √† B√©darieux. Enregistrement, mixage, mastering pour tous styles musicaux. √âquipement haut de gamme."
        }
      });
    }

    // 3. Cr√©er des √©v√©nements de test

    // √âv√©nement 1: Concert live au studio (√©v√©nement simple)
    console.log("Cr√©ation de l'√©v√©nement 'Concert Acoustique Live'...");
    const concertAcoustique = await prisma.event.create({
      data: {
        title: "Concert Acoustique Live",
        slug: "concert-acoustique-live-black-bear",
        description: `Venez d√©couvrir une soir√©e acoustique exceptionnelle au Black Bear Studio ! 

Nous vous proposons une exp√©rience musicale intime dans notre studio d'enregistrement professionnel, transform√© pour l'occasion en salle de concert intimiste.

Au programme :
üéµ Performances acoustiques d'artistes locaux
üé∏ D√©couverte d'instruments rares et vintage
üé§ Possibilit√© d'enregistrer votre propre session live
üç∑ Ap√©ritif et petites collations offertes

Une soir√©e unique dans un cadre exceptionnel, o√π la musique prend toute sa dimension !

Nombre de places limit√© √† 30 personnes pour pr√©server l'intimit√© de l'exp√©rience.

Artistes confirm√©s :
- Julie Martin (Folk/Indie)
- Les Fr√®res Guitare (Duo acoustique)
- Sarah K (Singer-songwriter)

Parking gratuit disponible. Acc√®s PMR.`,
        summary: "Soir√©e acoustique intimiste au Black Bear Studio avec des artistes locaux. Concert live dans un studio professionnel !",
        status: EventStatus.PUBLISHED,
        isPublished: true,
        isFeatured: true,
        organizerId: organizer.id,
        placeId: blackBearStudio.id,
        email: "events@blackbearstudio.fr",
        phone: "04 67 95 12 34",
        website: "https://blackbearstudio.fr/events",
        startDate: new Date(new Date().getTime() + 7 * 24 * 60 * 60 * 1000), // Dans 7 jours
        endDate: new Date(new Date().getTime() + 7 * 24 * 60 * 60 * 1000 + 4 * 60 * 60 * 1000), // 4h plus tard
        isAllDay: false,
        timezone: "Europe/Paris",
        maxParticipants: 30,
        isFree: false,
        price: 25.00,
        priceDetails: "Adulte: 25‚Ç¨, √âtudiant: 20‚Ç¨ (sur pr√©sentation de la carte), Enfant -12ans: gratuit",
        currency: "EUR",
        coverImage: "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=1200&h=600&fit=crop",
        images: JSON.stringify([
          "https://images.unsplash.com/photo-1516280440614-37939bbacd81?w=800&h=600&fit=crop",
          "https://images.unsplash.com/photo-1571330735066-03aaa9429d89?w=800&h=600&fit=crop",
          "https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?w=800&h=600&fit=crop"
        ]),
        videos: JSON.stringify([
          "https://www.youtube.com/embed/dQw4w9WgXcQ" // Exemple d'embed YouTube
        ]),
        metaTitle: "Concert Acoustique Live - Black Bear Studio B√©darieux",
        metaDescription: "Concert acoustique intimiste au Black Bear Studio avec des artistes locaux. Soir√©e unique dans un studio professionnel. Places limit√©es !",
        ogImage: "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=1200&h=630&fit=crop",
        facebook: "https://facebook.com/events/concert-acoustique-black-bear",
        instagram: "https://instagram.com/p/concert-acoustique-live",
        tags: JSON.stringify(["musique", "acoustique", "concert", "live", "studio", "intime", "artistes-locaux"]),
        category: EventCategory.CONCERT
      }
    });

    // √âv√©nement 2: Atelier d'enregistrement (√©v√©nement r√©current hebdomadaire)
    console.log("Cr√©ation de l'√©v√©nement r√©current 'Ateliers d'Enregistrement'...");
    
    // D'abord cr√©er la r√®gle de r√©currence
    const recurrenceRule = await prisma.recurrenceRule.create({
      data: {
        frequency: RecurrenceFrequency.WEEKLY,
        interval: 1, // Chaque semaine
        count: 12, // 12 occurrences (3 mois)
        byWeekDay: JSON.stringify([6]), // Samedi (6)
        workdaysOnly: false
      }
    });

    const atelierEnregistrement = await prisma.event.create({
      data: {
        title: "Ateliers d'Enregistrement - D√©couvrez le Studio",
        slug: "ateliers-enregistrement-decouverte",
        description: `Participez √† nos ateliers d'enregistrement tous les samedis !

Ces ateliers s'adressent √† tous les musiciens, d√©butants ou confirm√©s, qui souhaitent :
üéµ D√©couvrir l'univers de l'enregistrement studio
üéõÔ∏è Apprendre les bases du mixage et mastering
üé§ Enregistrer vos propres compositions
üé∏ Comprendre le fonctionnement d'un studio professionnel

Programme type (3h d'atelier) :
‚Ä¢ 9h00-10h00 : Pr√©sentation du mat√©riel et visite du studio
‚Ä¢ 10h00-11h30 : Session d'enregistrement pratique
‚Ä¢ 11h30-12h00 : Initiation au mixage et √©coute des prises

Mat√©riel fourni :
- Microphones professionnels
- Instruments (guitares, basse, batterie)
- Casques de monitoring
- Supports p√©dagogiques

Apportez vos propres instruments si vous le souhaitez !

Chaque participant repart avec l'enregistrement de sa session.

Groupe limit√© √† 8 participants pour un encadrement personnalis√©.`,
        summary: "Ateliers d'enregistrement hebdomadaires au Black Bear Studio. Apprenez les techniques de studio et enregistrez vos morceaux !",
        status: EventStatus.PUBLISHED,
        isPublished: true,
        isFeatured: false,
        organizerId: organizer.id,
        placeId: blackBearStudio.id,
        email: "ateliers@blackbearstudio.fr",
        phone: "04 67 95 12 34",
        website: "https://blackbearstudio.fr/ateliers",
        ticketUrl: "https://www.eventbrite.com/e/ateliers-enregistrement-black-bear",
        startDate: new Date(new Date().getTime() + 3 * 24 * 60 * 60 * 1000), // Dans 3 jours (samedi prochain)
        endDate: new Date(new Date().getTime() + 3 * 24 * 60 * 60 * 1000 + 3 * 60 * 60 * 1000), // 3h plus tard
        isAllDay: false,
        timezone: "Europe/Paris",
        maxParticipants: 8,
        isFree: false,
        price: 45.00,
        priceDetails: "Tarif unique: 45‚Ç¨ (mat√©riel et enregistrement inclus)",
        currency: "EUR",
        coverImage: "https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?w=1200&h=600&fit=crop",
        images: JSON.stringify([
          "https://images.unsplash.com/photo-1519508234439-4f23643125c1?w=800&h=600&fit=crop",
          "https://images.unsplash.com/photo-1571330735066-03aaa9429d89?w=800&h=600&fit=crop"
        ]),
        metaTitle: "Ateliers d'Enregistrement - Black Bear Studio",
        metaDescription: "Ateliers d'enregistrement hebdomadaires au Black Bear Studio. Apprenez les techniques de studio, 8 participants max. Tous niveaux bienvenus.",
        ogImage: "https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?w=1200&h=630&fit=crop",
        instagram: "https://instagram.com/explore/tags/atelierstudio",
        tags: JSON.stringify(["atelier", "enregistrement", "formation", "studio", "musique", "apprentissage", "technique"]),
        category: EventCategory.WORKSHOP,
        isRecurring: true,
        recurrenceRuleId: recurrenceRule.id
      }
    });

    // √âv√©nement 3: Festival de musique (√©v√©nement multi-jours)
    console.log("Cr√©ation du festival 'B√©darieux Music Days'...");
    const festivalStart = new Date(new Date().getTime() + 30 * 24 * 60 * 60 * 1000); // Dans 30 jours
    const festivalEnd = new Date(festivalStart.getTime() + 2 * 24 * 60 * 60 * 1000); // 3 jours plus tard

    const festival = await prisma.event.create({
      data: {
        title: "B√©darieux Music Days - Festival 2024",
        slug: "bedarieux-music-days-2024",
        description: `Le plus grand festival de musique de B√©darieux revient pour sa 5√®me √©dition !

3 jours de musique non-stop avec des artistes locaux et nationaux, dans un cadre exceptionnel m√™lant lieux embl√©matiques de la ville et notre studio Black Bear.

üé™ PROGRAMMATION :

JOUR 1 - VENDREDI : "Soir√©e D√©couverte"
‚Ä¢ 18h-20h : Plateau jeunes talents (Black Bear Studio)
‚Ä¢ 20h-22h : Concert folk/indie (Place de la R√©publique)
‚Ä¢ 22h-00h : DJ Set √©lectro (Black Bear Studio)

JOUR 2 - SAMEDI : "Journ√©e Festive"
‚Ä¢ 14h-16h : Ateliers musicaux familles
‚Ä¢ 16h-18h : Concert rock/pop
‚Ä¢ 18h-20h : Ap√©ro-concert jazz
‚Ä¢ 20h-23h : T√™tes d'affiche nationales
‚Ä¢ 23h-02h : After-party

JOUR 3 - DIMANCHE : "Cl√¥ture en Beaut√©"
‚Ä¢ 11h-13h : Brunch musical
‚Ä¢ 14h-17h : Concerts acoustiques
‚Ä¢ 17h-19h : C√©r√©monie de cl√¥ture

üé´ PASS FESTIVAL inclut :
- Acc√®s √† tous les concerts
- Ateliers et masterclasses
- Restauration partenaire (tarifs pr√©f√©rentiels)
- Acc√®s backstage pour les VIP
- Goodies exclusifs

üöó Navettes gratuites entre les diff√©rents lieux
üçΩÔ∏è Food trucks et stands locaux
üé® Expositions d'artistes locaux
üë∂ Espace famille et garde d'enfants`,
        summary: "Le festival incontournable de B√©darieux ! 3 jours de musique avec des artistes locaux et nationaux. 5√®me √©dition au Black Bear Studio.",
        status: EventStatus.PUBLISHED,
        isPublished: true,
        isFeatured: true,
        organizerId: organizer.id,
        placeId: blackBearStudio.id,
        email: "festival@bedarieuxmusicdays.fr",
        phone: "04 67 95 12 34",
        website: "https://bedarieuxmusicdays.fr",
        ticketUrl: "https://www.ticketmaster.fr/bedarieux-music-days-2024",
        startDate: festivalStart,
        endDate: festivalEnd,
        isAllDay: false,
        timezone: "Europe/Paris",
        locationName: "Black Bear Studio & Centre-ville de B√©darieux",
        locationAddress: "15 Avenue de la Musique et centre-ville",
        locationCity: "B√©darieux",
        locationLatitude: 43.6543,
        locationLongitude: 3.1687,
        maxParticipants: 500,
        isFree: false,
        price: 89.00,
        priceDetails: "Pass 3 jours: 89‚Ç¨, Pass jour: 35‚Ç¨, Tarif r√©duit √©tudiant: 65‚Ç¨, VIP: 150‚Ç¨",
        currency: "EUR",
        coverImage: "https://images.unsplash.com/photo-1549451371-64aa98a6f632?w=1200&h=600&fit=crop",
        images: JSON.stringify([
          "https://images.unsplash.com/photo-1540039155733-5bb30b53aa14?w=800&h=600&fit=crop",
          "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800&h=600&fit=crop",
          "https://images.unsplash.com/photo-1516280440614-37939bbacd81?w=800&h=600&fit=crop"
        ]),
        videos: JSON.stringify([
          "https://www.youtube.com/embed/festival-teaser-2024",
          "https://www.youtube.com/embed/best-of-festival-2023"
        ]),
        metaTitle: "B√©darieux Music Days 2024 - Festival de Musique",
        metaDescription: "5√®me √©dition du festival B√©darieux Music Days ! 3 jours de concerts avec artistes locaux et nationaux. Black Bear Studio et centre-ville.",
        ogImage: "https://images.unsplash.com/photo-1549451371-64aa98a6f632?w=1200&h=630&fit=crop",
        facebook: "https://facebook.com/BedarieuxMusicDays",
        instagram: "https://instagram.com/bedarieux_music_days",
        twitter: "https://twitter.com/BMD_Festival",
        tiktok: "https://tiktok.com/@bedarieux_music",
        tags: JSON.stringify(["festival", "musique", "bedarieux", "3-jours", "concert", "live", "artistes", "local", "national"]),
        category: EventCategory.FESTIVAL
      }
    });

    // 4. Cr√©er quelques participants pour les √©v√©nements
    console.log("Cr√©ation de participants de test...");
    
    // Cr√©er quelques utilisateurs participants s'ils n'existent pas
    const participants = await Promise.all([
      prisma.user.upsert({
        where: { email: "julie.martin@example.com" },
        update: {},
        create: {
          name: "Julie Martin",
          email: "julie.martin@example.com",
          emailVerified: true,
          slug: "julie-martin",
          role: "user",
          status: UserStatus.ACTIVE
        }
      }),
      prisma.user.upsert({
        where: { email: "pierre.dubois@example.com" },
        update: {},
        create: {
          name: "Pierre Dubois",
          email: "pierre.dubois@example.com",
          emailVerified: true,
          slug: "pierre-dubois",
          role: "user",
          status: UserStatus.ACTIVE
        }
      }),
      prisma.user.upsert({
        where: { email: "marie.lambert@example.com" },
        update: {},
        create: {
          name: "Marie Lambert",
          email: "marie.lambert@example.com",
          emailVerified: true,
          slug: "marie-lambert",
          role: "user",
          status: UserStatus.ACTIVE
        }
      })
    ]);

    // Ajouter des participations
    await prisma.eventParticipant.createMany({
      data: [
        // Concert acoustique
        {
          eventId: concertAcoustique.id,
          userId: participants[0].id,
          status: ParticipationStatus.GOING,
          guestCount: 1,
          specialNeeds: "R√©gime v√©g√©tarien"
        },
        {
          eventId: concertAcoustique.id,
          userId: participants[1].id,
          status: ParticipationStatus.GOING,
          guestCount: 0
        },
        {
          eventId: concertAcoustique.id,
          userId: participants[2].id,
          status: ParticipationStatus.INTERESTED,
          guestCount: 2
        },
        
        // Ateliers d'enregistrement
        {
          eventId: atelierEnregistrement.id,
          userId: participants[0].id,
          status: ParticipationStatus.GOING,
          guestCount: 0,
          specialNeeds: "D√©butant complet en enregistrement"
        },
        {
          eventId: atelierEnregistrement.id,
          userId: participants[1].id,
          status: ParticipationStatus.GOING,
          guestCount: 0
        },
        
        // Festival
        {
          eventId: festival.id,
          userId: participants[0].id,
          status: ParticipationStatus.GOING,
          guestCount: 2
        },
        {
          eventId: festival.id,
          userId: participants[1].id,
          status: ParticipationStatus.GOING,
          guestCount: 1
        },
        {
          eventId: festival.id,
          userId: participants[2].id,
          status: ParticipationStatus.MAYBE,
          guestCount: 0
        }
      ],
      skipDuplicates: true
    });

    // Mettre √† jour les compteurs de participants
    await Promise.all([
      prisma.event.update({
        where: { id: concertAcoustique.id },
        data: { participantCount: 3 }
      }),
      prisma.event.update({
        where: { id: atelierEnregistrement.id },
        data: { participantCount: 2 }
      }),
      prisma.event.update({
        where: { id: festival.id },
        data: { participantCount: 3 }
      })
    ]);

    console.log("‚úÖ Seed des √©v√©nements termin√© avec succ√®s !");
    console.log(`
üìÖ √âv√©nements cr√©√©s :
- ${concertAcoustique.title} (${concertAcoustique.slug})
- ${atelierEnregistrement.title} (${atelierEnregistrement.slug}) - R√âCURRENT
- ${festival.title} (${festival.slug}) - MULTI-JOURS

üè¢ Place li√©e :
- ${blackBearStudio.name} (${blackBearStudio.slug})

üë§ Organisateur :
- ${organizer.name} (${organizer.email})

üë• Participants cr√©√©s : ${participants.length}

üåê Vous pouvez maintenant :
- Consulter l'agenda : http://localhost:3000/events
- Voir les d√©tails : http://localhost:3000/events/[slug]
- G√©rer depuis le dashboard : http://localhost:3000/dashboard/events
    `);

  } catch (error) {
    console.error("‚ùå Erreur lors du seed:", error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

// Ex√©cuter le seed si appel√© directement
if (require.main === module) {
  seedEvents()
    .then(() => {
      console.log("üéâ Seed termin√© !");
      process.exit(0);
    })
    .catch((error) => {
      console.error("üí• Erreur fatale:", error);
      process.exit(1);
    });
}

export { seedEvents };